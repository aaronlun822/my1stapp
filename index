<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¯¦ç”¨å·¥å…·ç®±</title>
    
    <!-- Tailwind CSS (ç”¨æ–¼æ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PDF.js (ç”¨æ–¼è®€å– PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- JSZip (ç”¨æ–¼æ‰“åŒ…ä¸‹è¼‰) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        // è¨­å®š Tailwind é…ç½®ä»¥ç¬¦åˆ iOS é¢¨æ ¼
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        iosBlue: '#007AFF',
                        iosGray: '#F2F2F7',
                        iosGreen: '#34C759',
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.1)',
                    }
                }
            }
        }
    </script>
    <style>
        /* iOS é¢¨æ ¼å„ªåŒ– */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #F2F2F7;
            -webkit-tap-highlight-color: transparent;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        .btn-primary {
            background-color: #007AFF;
            color: white;
            transition: opacity 0.2s;
        }
        .btn-primary:active {
            opacity: 0.7;
        }
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #007AFF;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800 pb-10 safe-area-inset-bottom">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200 px-4 py-4 mb-6">
        <h1 class="text-xl font-bold text-center text-gray-900">å¯¦ç”¨å·¥å…·ç®±</h1>
    </header>

    <main class="max-w-md mx-auto px-4">

        <!-- 1. å–®ä½è½‰æ›å™¨ -->
        <section class="card">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
                <span class="bg-blue-100 text-blue-600 p-1 rounded mr-2">ğŸ“</span> å–®ä½è½‰æ›
            </h2>
            <div class="space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-xs text-gray-500 ml-1">æ•¸å€¼</label>
                        <input type="number" id="unitInput" placeholder="0" class="w-full bg-gray-100 rounded-lg p-3 outline-none focus:ring-2 focus:ring-iosBlue transition">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 ml-1">å–®ä½</label>
                        <select id="unitFrom" class="w-full bg-gray-100 rounded-lg p-3 outline-none focus:ring-2 focus:ring-iosBlue transition appearance-none">
                            <option value="m">å…¬å°º (m)</option>
                            <option value="cm" selected>å…¬åˆ† (cm)</option>
                            <option value="mm">æ¯«ç±³ (mm)</option>
                            <option value="ft">è‹±å‘ (ft)</option>
                            <option value="inch">è‹±å‹ (inch)</option>
                        </select>
                    </div>
                </div>

                <div class="flex justify-center text-gray-400 text-sm">â¬‡ï¸ è½‰æ›ç‚º</div>

                <div class="grid grid-cols-2 gap-2">
                    <div class="flex items-center bg-gray-50 rounded-lg p-3 border border-gray-200">
                        <span id="unitResult" class="font-bold text-gray-800 text-lg overflow-hidden text-ellipsis">0</span>
                    </div>
                    <div>
                        <select id="unitTo" class="w-full bg-gray-100 rounded-lg p-3 outline-none focus:ring-2 focus:ring-iosBlue transition appearance-none">
                            <option value="m">å…¬å°º (m)</option>
                            <option value="cm">å…¬åˆ† (cm)</option>
                            <option value="mm">æ¯«ç±³ (mm)</option>
                            <option value="ft" selected>è‹±å‘ (ft)</option>
                            <option value="inch">è‹±å‹ (inch)</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. WhatsApp å¿«é€Ÿå°è©± -->
        <section class="card">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
                <span class="bg-green-100 text-green-600 p-1 rounded mr-2">ğŸ’¬</span> WhatsApp å‚³é€é–€
            </h2>
            <div class="space-y-3">
                <div>
                    <label class="text-xs text-gray-500 ml-1">é›»è©±è™Ÿç¢¼ (å«å€ç¢¼ï¼Œå¦‚ 852)</label>
                    <input type="tel" id="waPhone" placeholder="85212345678" class="w-full bg-gray-100 rounded-lg p-3 outline-none focus:ring-2 focus:ring-iosGreen transition">
                </div>
                <div>
                    <label class="text-xs text-gray-500 ml-1">é è¨­è¨Šæ¯ (é¸å¡«)</label>
                    <textarea id="waMessage" rows="2" placeholder="ä½ å¥½..." class="w-full bg-gray-100 rounded-lg p-3 outline-none focus:ring-2 focus:ring-iosGreen transition resize-none"></textarea>
                </div>
                <button onclick="openWhatsApp()" class="w-full bg-[#25D366] text-white font-semibold py-3 rounded-lg shadow-sm active:opacity-80 transition flex items-center justify-center">
                    é–‹å•Ÿ WhatsApp å°è©±
                </button>
            </div>
        </section>

        <!-- 3. PDF è½‰ JPG -->
        <section class="card">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
                <span class="bg-red-100 text-red-600 p-1 rounded mr-2">ğŸ“„</span> PDF è½‰ JPG
            </h2>
            
            <!-- ä¸Šå‚³å€ -->
            <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center cursor-pointer hover:bg-gray-50 transition relative">
                <input type="file" id="pdfInput" accept="application/pdf" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                <div class="pointer-events-none">
                    <p class="text-3xl mb-2">ğŸ“¥</p>
                    <p class="text-sm text-gray-500 font-medium">é»æ“Šæˆ–æ‹–æ›³ PDF æª”æ¡ˆè‡³æ­¤</p>
                    <p class="text-xs text-gray-400 mt-1">æ”¯æ´å¤šé è½‰æª”</p>
                </div>
            </div>

            <!-- ç‹€æ…‹èˆ‡é€²åº¦ -->
            <div id="pdfStatus" class="hidden mt-4 text-center">
                <div class="flex items-center justify-center space-x-2 text-sm text-gray-600">
                    <div class="loader"></div>
                    <span id="statusText">æ­£åœ¨è™•ç†ä¸­...</span>
                </div>
            </div>

            <!-- ä¸‹è¼‰å…¨éƒ¨æŒ‰éˆ• (éš±è—) -->
            <button id="downloadAllBtn" onclick="downloadAllImages()" class="hidden w-full mt-4 bg-gray-800 text-white font-semibold py-3 rounded-lg shadow-sm active:opacity-80 transition">
                ğŸ“¦ ä¸‹è¼‰æ‰€æœ‰åœ–ç‰‡ (ZIP)
            </button>

            <!-- åœ–ç‰‡é è¦½å€ -->
            <div id="previewArea" class="mt-6 space-y-4">
                <!-- ç”Ÿæˆçš„åœ–ç‰‡æœƒæ”¾åœ¨é€™è£¡ -->
            </div>
        </section>

    </main>
    
    <footer class="text-center text-gray-400 text-xs py-8">
        Designed for iPhone & Desktop
    </footer>

    <script>
        // --- 1. å–®ä½è½‰æ›é‚è¼¯ ---
        const unitInput = document.getElementById('unitInput');
        const unitFrom = document.getElementById('unitFrom');
        const unitTo = document.getElementById('unitTo');
        const unitResult = document.getElementById('unitResult');

        const factors = {
            m: 1,
            cm: 0.01,
            mm: 0.001,
            ft: 0.3048,
            inch: 0.0254
        };

        function convertUnit() {
            const val = parseFloat(unitInput.value);
            if (isNaN(val)) {
                unitResult.innerText = "0";
                return;
            }
            const inMeters = val * factors[unitFrom.value];
            const result = inMeters / factors[unitTo.value];
            
            // è™•ç†å°æ•¸é»ï¼Œå¦‚æœæ˜¯æ•´æ•¸é¡¯ç¤ºæ•´æ•¸ï¼Œå¦å‰‡æœ€å¤š4ä½
            unitResult.innerText = Number.isInteger(result) ? result : result.toFixed(4).replace(/\.?0+$/, "");
        }

        [unitInput, unitFrom, unitTo].forEach(el => el.addEventListener('input', convertUnit));


        // --- 2. WhatsApp é‚è¼¯ ---
        function openWhatsApp() {
            let phone = document.getElementById('waPhone').value.replace(/\D/g, ''); // åªä¿ç•™æ•¸å­—
            const msg = encodeURIComponent(document.getElementById('waMessage').value);
            
            if (phone.length < 3) {
                alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»è©±è™Ÿç¢¼");
                return;
            }

            const url = `https://wa.me/${phone}?text=${msg}`;
            window.open(url, '_blank');
        }


        // --- 3. PDF è½‰ JPG é‚è¼¯ ---
        // è¨­å®š PDF.js Worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const pdfInput = document.getElementById('pdfInput');
        const dropZone = document.getElementById('dropZone');
        const pdfStatus = document.getElementById('pdfStatus');
        const statusText = document.getElementById('statusText');
        const previewArea = document.getElementById('previewArea');
        const downloadAllBtn = document.getElementById('downloadAllBtn');

        let generatedImages = []; // å„²å­˜ {blob, name}
        let originalFileName = "document";

        // æ‹–æ›³æ•ˆæœ
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });
        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });
        function highlight() { dropZone.classList.add('bg-blue-50', 'border-blue-400'); }
        function unhighlight() { dropZone.classList.remove('bg-blue-50', 'border-blue-400'); }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type === "application/pdf") {
                processPDF(files[0]);
            } else {
                alert("è«‹ä¸Šå‚³ PDF æª”æ¡ˆ");
            }
        }

        pdfInput.addEventListener('change', function(e) {
            if (this.files.length > 0) {
                processPDF(this.files[0]);
            }
        });

        async function processPDF(file) {
            // é‡ç½®
            previewArea.innerHTML = '';
            generatedImages = [];
            downloadAllBtn.classList.add('hidden');
            pdfStatus.classList.remove('hidden');
            statusText.innerText = "æ­£åœ¨è®€å– PDF...";
            originalFileName = file.name.replace('.pdf', '');

            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                const totalPages = pdf.numPages;

                for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                    statusText.innerText = `æ­£åœ¨è½‰æ›ç¬¬ ${pageNum} / ${totalPages} é ...`;
                    
                    const page = await pdf.getPage(pageNum);
                    const viewport = page.getViewport({ scale: 2.0 }); // 2.0 å€ç‡ä»¥ç²å¾—è¼ƒå¥½ç•«è³ª

                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;

                    // è½‰ç‚º Blob
                    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.85));
                    const imgUrl = URL.createObjectURL(blob);
                    const fileName = `${originalFileName}_page_${pageNum}.jpg`;

                    generatedImages.push({ blob: blob, name: fileName });

                    // å»ºç«‹é è¦½å¡ç‰‡
                    createImageCard(imgUrl, fileName, pageNum);
                }

                statusText.innerText = "è½‰æ›å®Œæˆï¼";
                setTimeout(() => pdfStatus.classList.add('hidden'), 2000);

                // å¦‚æœå¤šæ–¼ä¸€é ï¼Œé¡¯ç¤ºä¸‹è¼‰å…¨éƒ¨æŒ‰éˆ•
                if (totalPages > 1) {
                    downloadAllBtn.classList.remove('hidden');
                }

            } catch (error) {
                console.error(error);
                statusText.innerText = "ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ˜¯å¦ææ¯€";
                alert("è½‰æ›å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
            }
        }

        function createImageCard(url, fileName, pageNum) {
            const div = document.createElement('div');
            div.className = "bg-white p-3 rounded-lg border border-gray-200 shadow-sm";
            div.innerHTML = `
                <div class="text-sm font-semibold text-gray-500 mb-2">ç¬¬ ${pageNum} é </div>
                <img src="${url}" class="w-full h-auto rounded border border-gray-100 mb-3">
                <a href="${url}" download="${fileName}" class="block w-full text-center py-2 bg-gray-100 hover:bg-gray-200 text-blue-600 rounded text-sm font-medium transition">
                    ä¸‹è¼‰æ­¤å¼µåœ–ç‰‡
                </a>
            `;
            previewArea.appendChild(div);
        }

        function downloadAllImages() {
            const zip = new JSZip();
            generatedImages.forEach(img => {
                zip.file(img.name, img.blob);
            });

            downloadAllBtn.innerText = "æ­£åœ¨å£“ç¸®...";
            
            zip.generateAsync({type:"blob"}).then(function(content) {
                saveAs(content, `${originalFileName}_images.zip`);
                downloadAllBtn.innerText = "ğŸ“¦ ä¸‹è¼‰æ‰€æœ‰åœ–ç‰‡ (ZIP)";
            });
        }

    </script>
</body>
</html>


